Got it â€” exhibition-scale, multiple screens, but not mission control.

---

# MLED Controller â€” Exhibition Edition

## 1. Main View (Nodes + Quick Control)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ›ï¸  MLED Controller                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                    â”‚
â”‚  NODES                                          [ Select All ]     â”‚
â”‚                                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ â˜‘  ğŸŸ¢ pedestal-01       -42dBm     ğŸ¨ Rainbow              â”‚    â”‚
â”‚  â”‚ â˜‘  ğŸŸ¢ pedestal-02       -38dBm     ğŸ¨ Rainbow              â”‚    â”‚
â”‚  â”‚ â˜‘  ğŸŸ¢ wall-left         -45dBm     ğŸ¨ Rainbow              â”‚    â”‚
â”‚  â”‚ â˜  ğŸŸ¢ wall-right        -51dBm     ğŸ¨ Solid Blue           â”‚    â”‚
â”‚  â”‚ â˜  ğŸŸ¡ ceiling           -71dBm     ğŸ¨ Off          (weak)  â”‚    â”‚
â”‚  â”‚ â˜  ğŸ”´ floor-01          ---        offline (3m)            â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                    â”‚
â”‚  5 online Â· 1 offline Â· 3 selected                                 â”‚
â”‚                                                                    â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
â”‚                                                                    â”‚
â”‚  QUICK APPLY                                                       â”‚
â”‚                                                                    â”‚
â”‚  [ ğŸŒˆ Rainbow ] [ ğŸ’™ Calm ] [ ğŸ”¥ Warm ] [ âš¡ Pulse ] [ â¬› Off ]    â”‚
â”‚                                                                    â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
â”‚                                                                    â”‚
â”‚  Brightness: [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘] 70%          [ Apply to Selected ]       â”‚
â”‚                                                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [ ğŸ  Nodes ]        [ ğŸ¨ Patterns ]        [ â„¹ï¸ Status ]          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. Patterns View (Edit & Create Presets)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ›ï¸  MLED Controller                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                    â”‚
â”‚  PRESETS                                            [ + New ]      â”‚
â”‚                                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  ğŸŒˆ Rainbow          cycle, speed 50                       â”‚    â”‚
â”‚  â”‚  ğŸ’™ Calm             solid #2244AA, 60%                    â”‚    â”‚
â”‚  â”‚  ğŸ”¥ Warm             gradient orangeâ†’red                   â”‚    â”‚
â”‚  â”‚  âš¡ Pulse            strobe white, 2Hz                     â”‚    â”‚
â”‚  â”‚  â¬› Off              solid black                           â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                    â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
â”‚                                                                    â”‚
â”‚  EDIT: Rainbow                                                     â”‚
â”‚                                                                    â”‚
â”‚  Name:     [ Rainbow____________ ]                                 â”‚
â”‚                                                                    â”‚
â”‚  Type:     [ Rainbow Cycle â–¼ ]                                     â”‚
â”‚                                                                    â”‚
â”‚  Speed:    [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘] 50                                         â”‚
â”‚                                                                    â”‚
â”‚  Brightness: [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘] 70%                                      â”‚
â”‚                                                                    â”‚
â”‚                                                                    â”‚
â”‚  [ ğŸ‘ï¸ Preview on Selected ]    [ ğŸ’¾ Save ]    [ ğŸ—‘ï¸ Delete ]        â”‚
â”‚                                                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [ ğŸ  Nodes ]        [ ğŸ¨ Patterns ]        [ â„¹ï¸ Status ]          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. Status View (What's Wrong?)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ›ï¸  MLED Controller                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                    â”‚
â”‚  SYSTEM STATUS                                      âœ… Healthy     â”‚
â”‚                                                                    â”‚
â”‚  Controller:   192.168.1.112 (eth0)                                â”‚
â”‚  Multicast:    239.255.0.1:5000                                    â”‚
â”‚  Nodes:        5/6 online                                          â”‚
â”‚                                                                    â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
â”‚                                                                    â”‚
â”‚  PROBLEMS                                                          â”‚
â”‚                                                                    â”‚
â”‚  âš ï¸  ceiling â€” weak signal (-71dBm), may drop                      â”‚
â”‚  âŒ floor-01 â€” offline for 3 minutes                               â”‚
â”‚                                                                    â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
â”‚                                                                    â”‚
â”‚  NODE DETAILS                                                      â”‚
â”‚                                                                    â”‚
â”‚  â”‚ Node          â”‚ Signal â”‚ Uptime  â”‚ Pattern     â”‚ Status   â”‚    â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚
â”‚  â”‚ pedestal-01   â”‚ -42dBm â”‚ 2h 14m  â”‚ Rainbow     â”‚ ğŸŸ¢ good  â”‚    â”‚
â”‚  â”‚ pedestal-02   â”‚ -38dBm â”‚ 2h 14m  â”‚ Rainbow     â”‚ ğŸŸ¢ good  â”‚    â”‚
â”‚  â”‚ wall-left     â”‚ -45dBm â”‚ 1h 58m  â”‚ Rainbow     â”‚ ğŸŸ¢ good  â”‚    â”‚
â”‚  â”‚ wall-right    â”‚ -51dBm â”‚ 2h 14m  â”‚ Solid Blue  â”‚ ğŸŸ¢ good  â”‚    â”‚
â”‚  â”‚ ceiling       â”‚ -71dBm â”‚ 0h 42m  â”‚ Off         â”‚ ğŸŸ¡ weak  â”‚    â”‚
â”‚  â”‚ floor-01      â”‚ ---    â”‚ ---     â”‚ ---         â”‚ ğŸ”´ off   â”‚    â”‚
â”‚                                                                    â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
â”‚                                                                    â”‚
â”‚  [ ğŸ”„ Refresh All ]                    [ âš™ï¸ Settings ]             â”‚
â”‚                                                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [ ğŸ  Nodes ]        [ ğŸ¨ Patterns ]        [ â„¹ï¸ Status ]          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 4. Settings (Tucked Away)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ›ï¸  MLED Controller â€º Settings                      [ â† Back ]   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                    â”‚
â”‚  NETWORK                                                           â”‚
â”‚                                                                    â”‚
â”‚  Bind IP:         [ eth0: 192.168.1.112 â–¼ ]                        â”‚
â”‚  Multicast:       [ 239.255.0.1 ] : [ 5000 ]                       â”‚
â”‚                                                                    â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
â”‚                                                                    â”‚
â”‚  TIMING                                                            â”‚
â”‚                                                                    â”‚
â”‚  Discovery interval:    [ 1000 ] ms                                â”‚
â”‚  Offline threshold:     [ 30   ] seconds                           â”‚
â”‚                                                                    â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
â”‚                                                                    â”‚
â”‚  PRESETS                                                           â”‚
â”‚                                                                    â”‚
â”‚  [ ğŸ“¤ Export All ]     [ ğŸ“¥ Import ]                               â”‚
â”‚                                                                    â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
â”‚                                                                    â”‚
â”‚  [ ğŸ’¾ Save ]                                                       â”‚
â”‚                                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Summary

| Screen | Purpose |
|--------|---------|
| **Nodes** | See everything, quick preset buttons, apply |
| **Patterns** | Edit/create presets with sliders |
| **Status** | "What's broken?" at a glance |
| **Settings** | Network config, hidden away |

3 main tabs + settings. That feel right?

---Away

# MLED Controller â€” Exhibition Edition Implementation Spec

## Overview

A minimal 3-tab UI for controlling MLED nodes at an exhibition. Direct pattern application (no two-phase cues), preset management, and basic diagnostics.

---

## Protocol Primitives (from mled_protocol.h)

| Primitive | Direction | Purpose | UI Usage |
|-----------|-----------|---------|----------|
| `PING` | Controller â†’ Nodes | Discovery | Continuous background |
| `PONG` | Nodes â†’ Controller | Presence + status | Populates node list |
| `PATTERN_APPLY` | Controller â†’ Nodes | Immediate pattern change | "Apply" button, presets |
| `BEACON` | Controller â†’ Nodes | Time sync broadcast | Background (optional) |
| `TIME_REQ/RESP` | Bidirectional | Clock offset measurement | Status view (optional) |

**Not used in exhibition edition:** `CUE_PREPARE`, `CUE_FIRE`, `CUE_CANCEL`, epoch management.

---

## Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         UDP          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Controller Backend â”‚ â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚   MLED Nodes    â”‚
â”‚  (Python/asyncio)   â”‚   PING/PONG/APPLY    â”‚   (ESP32-C6)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ HTTP + WebSocket (localhost:8080)
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Web UI (Preact)   â”‚
â”‚   + Zustand store   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Data Models

### Node

```typescript
interface Node {
  node_id: string;          // hex, e.g. "4A7F2C01"
  name: string;             // from PONG or user-assigned
  ip: string;
  port: number;
  rssi: number;             // dBm, from PONG
  uptime_ms: number;        // from PONG
  last_seen: number;        // unix timestamp ms
  current_pattern: PatternConfig | null;
  status: 'online' | 'weak' | 'offline';
}
```

### PatternConfig

```typescript
interface PatternConfig {
  type: PatternType;
  brightness: number;       // 0-100
  params: Record<string, number | string>;
}

type PatternType = 
  | 'solid' 
  | 'rainbow' 
  | 'gradient' 
  | 'pulse' 
  | 'off';
```

### Preset

```typescript
interface Preset {
  id: string;               // uuid
  name: string;
  icon: string;             // emoji
  config: PatternConfig;
}
```

---

## Backend API

### HTTP Endpoints

| Method | Path | Request Body | Response | Description |
|--------|------|--------------|----------|-------------|
| `GET` | `/api/nodes` | â€” | `Node[]` | List all known nodes |
| `GET` | `/api/presets` | â€” | `Preset[]` | List saved presets |
| `POST` | `/api/presets` | `Preset` | `Preset` | Create preset |
| `PUT` | `/api/presets/:id` | `Preset` | `Preset` | Update preset |
| `DELETE` | `/api/presets/:id` | â€” | `{ok: true}` | Delete preset |
| `POST` | `/api/apply` | `ApplyRequest` | `ApplyResponse` | Apply pattern to nodes |
| `GET` | `/api/settings` | â€” | `Settings` | Get current settings |
| `PUT` | `/api/settings` | `Settings` | `Settings` | Update settings |

#### ApplyRequest

```typescript
interface ApplyRequest {
  node_ids: string[] | 'all';
  config: PatternConfig;
}
```

#### ApplyResponse

```typescript
interface ApplyResponse {
  sent_to: string[];        // node_ids we sent to
  failed: string[];         // node_ids that were offline
}
```

### WebSocket Events (ws://localhost:8080/ws)

#### Server â†’ Client

| Event | Payload | Trigger |
|-------|---------|---------|
| `node.update` | `Node` | PONG received, status change |
| `node.offline` | `{node_id: string}` | No PONG for threshold |
| `apply.ack` | `{node_id: string, success: boolean}` | After PATTERN_APPLY |
| `error` | `{message: string}` | Network issues, etc. |

#### Client â†’ Server

| Event | Payload | Action |
|-------|---------|--------|
| `refresh` | â€” | Force PING broadcast |

---

## UI State (Zustand)

```typescript
interface Store {
  // Nodes
  nodes: Map<string, Node>;
  selectedNodeIds: Set<string>;
  
  // Presets
  presets: Preset[];
  editingPreset: Preset | null;
  
  // UI
  currentTab: 'nodes' | 'patterns' | 'status';
  globalBrightness: number;
  
  // Connection
  connected: boolean;
  lastError: string | null;
  
  // Actions
  selectNode(id: string, selected: boolean): void;
  selectAll(): void;
  selectNone(): void;
  applyPreset(preset: Preset): void;
  applyConfig(config: PatternConfig): void;
  savePreset(preset: Preset): void;
  deletePreset(id: string): void;
  setGlobalBrightness(value: number): void;
}
```

---

## Screen Specifications

### Screen 1: Nodes (Main View)

**Purpose:** See all nodes, select targets, quick-apply presets.

**Components:**

```
â”Œâ”€ NodeList â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                    â”‚
â”‚  â”Œâ”€ NodeRow â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ [checkbox] [status dot] [name] [rssi] [pattern] â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  ... repeated                                      â”‚
â”‚                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€ PresetBar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [PresetButton] [PresetButton] [PresetButton] ...   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€ BrightnessControl â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Brightness: [slider] 70%     [Apply to Selected]   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Behavior:**

| Interaction | Action |
|-------------|--------|
| Check node | Toggle `selectedNodeIds` |
| "Select All" | Select all online nodes |
| Click preset | `POST /api/apply` with preset config + selected nodes |
| Adjust brightness | Update `globalBrightness` (local state) |
| "Apply to Selected" | `POST /api/apply` with current pattern + brightness |

**Status dot logic:**

| Condition | Color | Label |
|-----------|-------|-------|
| `last_seen < 5s` | ğŸŸ¢ | â€” |
| `last_seen < 30s` | ğŸŸ¡ | (weak) |
| `last_seen â‰¥ 30s` | ğŸ”´ | offline |
| `rssi < -70dBm` | ğŸŸ¡ | (weak signal) |

---

### Screen 2: Patterns (Preset Editor)

**Purpose:** Create, edit, preview presets.

**Components:**

```
â”Œâ”€ PresetList â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [icon] [name] [summary]                  [+ New]   â”‚
â”‚ ... repeated, selectable                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€ PresetEditor â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Name: [input]                                      â”‚
â”‚ Icon: [emoji picker or input]                      â”‚
â”‚ Type: [dropdown]                                   â”‚
â”‚                                                    â”‚
â”‚ â”Œâ”€ PatternParams (dynamic) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚ (varies by pattern type)                      â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                    â”‚
â”‚ Brightness: [slider]                               â”‚
â”‚                                                    â”‚
â”‚ [Preview] [Save] [Delete]                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Pattern parameters by type:**

| Type | Parameters |
|------|------------|
| `solid` | `color: hex` |
| `rainbow` | `speed: 0-100` |
| `gradient` | `color_start: hex`, `color_end: hex` |
| `pulse` | `color: hex`, `speed: 0-100` |
| `off` | (none) |

**Behavior:**

| Interaction | Action |
|-------------|--------|
| Select preset | Load into editor |
| "+ New" | Create blank preset, open editor |
| "Preview" | `POST /api/apply` with editor config to selected nodes |
| "Save" | `POST/PUT /api/presets` |
| "Delete" | `DELETE /api/presets/:id` (with confirm) |

---

### Screen 3: Status

**Purpose:** See what's healthy, what's broken.

**Components:**

```
â”Œâ”€ SystemBanner â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [status icon] [summary text]                       â”‚
â”‚ Controller: [ip]   Nodes: [n/m online]             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€ ProblemList â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [âš ï¸/âŒ] [node name] â€” [problem description]         â”‚
â”‚ ... repeated (or "No problems" if empty)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€ NodeTable â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Name | Signal | Uptime | Pattern | Status          â”‚
â”‚ -----+--------+--------+---------+--------         â”‚
â”‚ ...                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

[Refresh All]                        [Settings]
```

**Problem detection rules:**

| Condition | Icon | Message |
|-----------|------|---------|
| `status === 'offline'` | âŒ | `{name} â€” offline for {duration}` |
| `rssi < -70dBm` | âš ï¸ | `{name} â€” weak signal ({rssi}dBm)` |
| `last_seen > 10s && < 30s` | âš ï¸ | `{name} â€” intermittent connection` |

---

### Screen 4: Settings (Modal or Sub-page)

**Purpose:** Network config, import/export.

**Fields:**

| Field | Type | Default | Description |
|-------|------|---------|-------------|
| `bind_ip` | dropdown | auto | Network interface |
| `multicast_group` | text | `239.255.0.1` | Multicast address |
| `multicast_port` | number | `5000` | UDP port |
| `discovery_interval_ms` | number | `1000` | PING frequency |
| `offline_threshold_s` | number | `30` | When to mark offline |

**Actions:**

| Button | Behavior |
|--------|----------|
| "Export Presets" | Download `presets.json` |
| "Import Presets" | File picker, merge/replace presets |
| "Save" | `PUT /api/settings`, restart discovery |

---

## Implementation Plan

### Phase 1: Backend Core (Days 1-2)

- [ ] UDP socket handling (bind, multicast join)
- [ ] PING loop (configurable interval)
- [ ] PONG parser â†’ node state
- [ ] PATTERN_APPLY encoder + sender
- [ ] In-memory node store with TTL expiry
- [ ] HTTP server (FastAPI or aiohttp)
  - [ ] `GET /api/nodes`
  - [ ] `POST /api/apply`
- [ ] WebSocket server
  - [ ] `node.update` events
  - [ ] `node.offline` events

### Phase 2: Backend Presets (Day 3)

- [ ] Preset CRUD endpoints
- [ ] JSON file persistence (`~/.mled/presets.json`)
- [ ] Settings endpoints
- [ ] Settings file persistence (`~/.mled/config.json`)

### Phase 3: UI Shell (Day 4)

- [ ] Preact + Zustand project setup
- [ ] Tab navigation component
- [ ] WebSocket connection + reconnect logic
- [ ] Store hydration from HTTP endpoints

### Phase 4: Nodes Screen (Day 5)

- [ ] NodeList component
- [ ] NodeRow with checkbox, status dot, info
- [ ] Selection state management
- [ ] PresetBar with quick-apply buttons
- [ ] BrightnessControl slider
- [ ] "Apply to Selected" action

### Phase 5: Patterns Screen (Day 6)

- [ ] PresetList component
- [ ] PresetEditor form
- [ ] Dynamic PatternParams by type
- [ ] Color picker for solid/gradient
- [ ] Preview / Save / Delete actions
- [ ] New preset flow

### Phase 6: Status Screen (Day 7)

- [ ] SystemBanner with health summary
- [ ] ProblemList with auto-detection
- [ ] NodeTable sortable view
- [ ] Refresh button
- [ ] Settings modal/page

### Phase 7: Polish (Day 8)

- [ ] Loading states
- [ ] Error toasts
- [ ] Offline/reconnecting banner
- [ ] Keyboard shortcuts (select all: âŒ˜A, apply: Enter)
- [ ] Mobile-friendly layout
- [ ] Test with real nodes

---

## File Structure

```
mled-controller/
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ main.py              # entry point
â”‚   â”œâ”€â”€ udp.py               # MLED protocol handling
â”‚   â”œâ”€â”€ nodes.py             # node state management
â”‚   â”œâ”€â”€ presets.py           # preset CRUD
â”‚   â”œâ”€â”€ settings.py          # config management
â”‚   â”œâ”€â”€ api.py               # HTTP routes
â”‚   â””â”€â”€ ws.py                # WebSocket handler
â”‚
â”œâ”€â”€ frontend/
â”‚   â”œâ”€â”€ index.html
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ main.tsx         # entry
â”‚   â”‚   â”œâ”€â”€ store.ts         # Zustand store
â”‚   â”‚   â”œâ”€â”€ api.ts           # HTTP + WS client
â”‚   â”‚   â”œâ”€â”€ App.tsx          # shell + tabs
â”‚   â”‚   â”œâ”€â”€ screens/
â”‚   â”‚   â”‚   â”œâ”€â”€ Nodes.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ Patterns.tsx
â”‚   â”‚   â”‚   â””â”€â”€ Status.tsx
â”‚   â”‚   â””â”€â”€ components/
â”‚   â”‚       â”œâ”€â”€ NodeRow.tsx
â”‚   â”‚       â”œâ”€â”€ PresetButton.tsx
â”‚   â”‚       â”œâ”€â”€ PresetEditor.tsx
â”‚   â”‚       â”œâ”€â”€ Slider.tsx
â”‚   â”‚       â””â”€â”€ ColorPicker.tsx
â”‚   â””â”€â”€ package.json
â”‚
â”œâ”€â”€ config/
â”‚   â””â”€â”€ default_presets.json
â”‚
â””â”€â”€ README.md
```

---

## Default Presets

```json
[
  {
    "id": "preset-rainbow",
    "name": "Rainbow",
    "icon": "ğŸŒˆ",
    "config": {
      "type": "rainbow",
      "brightness": 75,
      "params": { "speed": 50 }
    }
  },
  {
    "id": "preset-calm",
    "name": "Calm",
    "icon": "ğŸ’™",
    "config": {
      "type": "solid",
      "brightness": 60,
      "params": { "color": "#2244AA" }
    }
  },
  {
    "id": "preset-warm",
    "name": "Warm",
    "icon": "ğŸ”¥",
    "config": {
      "type": "gradient",
      "brightness": 70,
      "params": { "color_start": "#FF6B35", "color_end": "#AA2200" }
    }
  },
  {
    "id": "preset-pulse",
    "name": "Pulse",
    "icon": "âš¡",
    "config": {
      "type": "pulse",
      "brightness": 80,
      "params": { "color": "#FFFFFF", "speed": 60 }
    }
  },
  {
    "id": "preset-off",
    "name": "Off",
    "icon": "â¬›",
    "config": {
      "type": "off",
      "brightness": 0,
      "params": {}
    }
  }
]
```

---

